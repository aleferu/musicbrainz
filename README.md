# MusicBrainz database study

This repository serves as a way of working with multiple computers and as a way of showing my work to the professor that guides me.

## .env file

A .env file is needed in order to configure the database connection. An example .env file is provided. Modify its contents to satisfy your needs.

## Contents

They must be executed in the following order (the subitems are the files generated by the notebook):

- `recordings_and_releases.ipynb`: Summary of all I've been learning/working on about `recordings` and `releases`, as well of the needed code to extract CSVs and some graphs.
    - `releases-*.csv`, * being from 1 to 5.
- `genres.ipynb`: Shows that the genre entity is useless in MB at the moment. At least I can't find a way of using it.
- `various_artists_cleanup.py`: Script that merges the releases CSVs while removing the artist with ID 1 ("Various Artists").
    - `releases_no_va.csv`
- `artist_artist.ipynb`: Shows how to generate CSVs containing information on relationships between artists and how to merge different instances of the same artist. It also exports all the information gathered until this point, but modified.
    - `artists.jsonl`
    - `relationships.csv`
    - `artist_tags.csv`
    - `releases_no_va_merged.csv`
- `relationships_cleanup.py`: Generates a version of the relationships CSV without duplicates.
    - `relationships_clean.csv`
- `lastfm.ipynb`: Shows how we can use [last.fm](https://www.last.fm/)'s API and extract the information that holds.
- `add_id_final_releases_csv.py`: Generates an id column to `releases_no_va_merged.csv` and modifies the data so that Neo4j won't complain.
    - `releases_no_va_merged_id.csv`
- `tags.ipynb`: Extracts MB's tags into a useful format for later use.
    - `mb_tags.json`
- `neo4j_import.py`: Imports our current dataset into a [Neo4j database](https://neo4j.com/).
    - From now on the idea is to never manage several files anymore and keep it in this Neo4j DB.

## Dependencies

A working python environment with the following:

```
psycopg2 pandas sqlalchemy matplotlib python-dotenv notebook networkx
```

Use conda, pip... Whatever. Example:

```bash
conda create -n foo psycopg2 pandas sqlalchemy matplotlib python-dotenv notebook networkx
```

## PostgreSQL (MusicBrainz) database installation

I followed [this link](https://musicbrainz.org/doc/MusicBrainz_Server/Setup), section **Setup from source code**. In theory you can install the database without the web server but I didn't want to mess up by skipping a crucial step by accident. The web server installation is very fast, unlike the database installation, so I recommend doing it that way.

## Neo4j database installation

Just used Debian's (or Mint's in my case) APT command and added some configuration to `/etc/neo4j/neo4j.conf`. Guide: [link to guide](https://debian.neo4j.com/).

```bash
wget -O - https://debian.neo4j.com/neotechnology.gpg.key | sudo apt-key add -
echo 'deb https://debian.neo4j.com stable 5' | sudo tee /etc/apt/sources.list.d/neo4j.list
sudo apt update
sudo apt install neo4j
```

Configuration (added at the start of `/etc/neo4j/neo4j.conf`):

```
server.memory.heap.max_size=8G
server.memory.heap.initial_size=7G
dbms.security.auth_enabled=false
dbms.usage_report.enabled=false
dbms.security.procedures.unrestricted=apoc.*
dbms.security.procedures.allowlist=apoc.*
dbms.memory.transaction.total.max=7g
```

The just `sudo neo4j start/stop/restart...` to run.

## LICENSE

No license right now as I don't know if this work can be exposed to the public at the moment of writing this README.
